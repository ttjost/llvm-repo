#include <stdio.h>
#include <stdlib.h>

typedef unsigned char Xuint8;
typedef unsigned long Xuint32;


//#define NROWS 256
//#define NCOLS 256
#define N_ELEMS 200
#define N_FADES 10

//Xuint8 image1[256]; Xuint8 image2[256]; Xuint8 imageR[256];
// Seed 0
Xuint8 image1[N_ELEMS] = {
    96, 56, 122, -66, -10, 58, -73, 3, 62, 109, 43, 75, 35, 77, 47,
    88, 8, 7, -14, -15, 15, 112, 88, -10, -104, 56, 31, -76, 8, 95,
    67, 122, -53, -25, -92, 108, -101, -54, -27, -106, 1, 46, -106, 68, 28,
    -42, -108, -112, -96, -36, -81, 59, 33, -99, -114, -64, -111, -13, -49, -90,
    7, -87, 114, 21, -63, 43, 119, -84, 108, 125, -60, -111, -94, 110, 76,
    -55, -77, 12, 110, -56, -89, 90, -102, 75, -125, 64, 58, 102, -53, -62,
    -50, -40, 72, 116, 89, -90, 11, 45, -5, -26, -79, -6, -33, -37, -25,
    86, 86, 66, 48, -105, 68, -21, -27, -86, -70, -118, 125, 2, -28, -50,
    14, -51, 37, -77, 20, 104, -128, 20, 112, 21, 57, -125, -78, -21, -69,
    92, -102, 13, -68, 23, -37, 30, -98, -34, 35, -12, 24, 95, 87, -117,
    21, -30, 35, 59, -36, -99, -79, 45, 112, 71, -73, 11, 57, -22, -73,
    -10, -29, -3, -126, -67, -123, -79, -3, 74, 6, -117, 39, 95, -68, 50,
    90, -126, 85, -118, -48, 54, -6, 0, 104, 107, -79, 39, -86, 54, 2,
    -124, 8, -60, -35, -91
};


// Seed 1
Xuint8 image2[N_ELEMS] = {
    115, -40, 111, -110, -4, -16, -27, -35, -43, 104, 114, 18, -70, 126, -76,
    -28, -79, -4, -87, 59, -127, -104, 61, 54, 100, -98, 36, 115, -5, -52,
    -22, -115, -127, 124, 71, -26, 67, 8, -73, -91, 79, 105, 74, 2, 107,
    33, -72, -64, 73, 91, -72, -5, -8, 79, -111, 35, -100, -21, -16, 72,
    97, -81, -4, -105, -84, -40, -88, 36, -109, -64, 71, -23, -113, -124, 101,
    14, 112, -25, -45, 106, -112, 117, 3, 73, 75, -21, -106, 111, -82, -43,
    51, 93, 109, 121, -102, -46, 26, -13, -8, -108, -108, -95, 124, 111, -68,
    -64, 41, 126, 111, 87, -18, -88, -81, 83, -13, 109, 35, -13, 53, -30,
    -63, 102, 84, -7, -55, -79, -85, 6, -12, -42, -95, 126, -19, 50, 62,
    1, 0, 38, 1, -103, 16, -7, -17, 68, -50, -3, -17, -81, 40, -17,
    85, 68, -2, -93, -69, 102, 27, -32, 23, -5, 98, -120, 10, 42, 71,
    -4, 118, 101, -127, -66, 82, -87, -3, 87, -64, 4, 21, 122, 95, 88,
    1, 105, -34, 93, -115, -105, -47, -21, 12, -114, -57, 121, -116, 18, -101,
    -32, 74, -122, 10, 101
};


// Seed 2
Xuint8 imageR[N_ELEMS] = {
    57, -8, -112, 23, -22, -51, 92, 78, 15, 121, -100, -67, -12, -20, 36,
    64, -73, 30, -123, 94, 44, 31, -114, 117, 1, 109, 21, 55, 34, -123,
    -9, 84, 94, -68, 92, 120, 74, 78, 63, 120, 101, -73, 45, -57, 124,
    65, 76, 46, 80, -34, -98, -68, 117, 55, -121, -6, 124, 4, -116, 99,
    84, -99, 93, 18, -19, -47, 21, -67, 29, -10, -65, -31, -57, 65, 27,
    62, 57, 87, -94, -122, -42, 35, -56, 80, -12, -22, -128, 82, 7, -100,
    5, -49, -2, 107, -42, 78, -19, -95, 1, -116, -21, -82, -92, -77, 61,
    -128, -80, -53, -77, 23, -16, 111, 82, 88, 73, -60, 50, 32, 67, -89,
    -87, -101, -57, 37, -87, -41, 42, 47, 102, -109, 106, -114, 59, 93, -74,
    20, -50, -37, 51, 19, 113, 104, -3, 19, -53, -30, 107, -66, -73, -63,
    -106, 31, 107, 108, 28, 11, -35, -57, 33, -33, 97, 16, -106, 107, -106,
    -21, -67, 45, -125, -70, -20, -63, -4, 50, -112, -104, 74, 43, 116, -24,
    10, -74, 67, -29, 85, 116, 75, 42, 33, 37, -125, -124, -26, 127, -49,
    -54, -124, 64, -127, 38
};


// Seed 3
Xuint8 fades[N_FADES] = {
    76, -104, -123, -22, -16, -124, -118, 40, -90, 115
};



void  compositing(Xuint8 *image1, Xuint8 *image2, Xuint8 *imageR, int nelem, Xuint8 fade);


void  compositing(Xuint8 *image1, Xuint8 *image2, Xuint8 *imageR, int nelem, Xuint8 fade)
{
  int i;
  for (i=0; i < nelem; i++, image1++, image2++, imageR++) {
    int T = *image1 - *image2;
    if (T < 0) T = 0;
    T = (T * fade) >> 8;
    T = T + *image2;
    if (T > 255) T = 255;
    *imageR = (Xuint8) T;
  }
}

int main() {

	//int nelem = 100; Xuint8 fade = 3;
	int i;

	for(i=0; i<N_FADES; i++) {
		compositing(image1, image2, imageR, N_ELEMS, fades[i]);
	}

	//compositing(image1, image2, imageR, nelem, fade);

	return 0;
}


